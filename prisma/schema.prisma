// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
    provider = "prisma-client"
    output = "../src/lib/prisma/generated"
}

datasource db {
    provider = "postgresql"
}

enum TransactionType {
    EXPENSE
    INCOME
}

enum CategoryScope {
    GLOBAL
    USER
}

model User {
    id           String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
    email        String        @unique
    createdAt    DateTime      @default(now())
    updatedAt    DateTime      @updatedAt
    wallets      Wallet[]
    transactions Transaction[]
    categories   Category[]

    @@map("users")
}

model Wallet {
    id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
    userId    String   @db.Uuid
    name      String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
    transactions Transaction[]

    @@index([userId, name])
    @@map("wallets")
}

model Transaction {
    id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
    userId          String   @db.Uuid
    walletId        String   @db.Uuid
    categoryId      String   @db.Uuid
    transactionDate DateTime
    description     String?
    amount          Decimal  @db.Decimal(19, 4)
    createdAt       DateTime @default(now())
    updatedAt       DateTime @updatedAt

    user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
    wallet   Wallet   @relation(fields: [walletId], references: [id], onDelete: Restrict)
    category Category @relation(fields: [categoryId], references: [id], onDelete: Restrict)

    @@index([userId, transactionDate])
    @@index([walletId, transactionDate])
    @@index([userId, walletId])
    @@index([categoryId, transactionDate])
    @@map("transactions")
}

model Category {
    id        String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
    scope     CategoryScope   @default(GLOBAL)
    ownerId   String?         @db.Uuid
    name      String
    icon      String
    type      TransactionType
    createdAt DateTime        @default(now())
    updatedAt DateTime        @updatedAt

    user         User?         @relation(fields: [ownerId], references: [id], onDelete: Cascade)
    transactions Transaction[]

    @@index([scope, type])
    @@index([ownerId, type])
    @@map("categories")
}